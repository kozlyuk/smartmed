{% load ita_template_tags %}
{% load bootstrap4 %}
{% load static %}
{% load widget_tweaks %} 
{% for form in invoice_line_formset %}
{{ form.DELETE | add_class:"hidden" }} {% comment %} <!--add |add_class:"hidden" in production--> {% endcomment %}
<tr id="{{ forloop.counter0 }}">
    <td><a href="#"><img src="{{form.instance.product.get_image}}" alt="product image"></a></td>
    <td><a href="#">{{ form.instance.product }}</a></td>
    <td>
        <div class="form-group">
            {{ form.quantity|attr:"class:form-control productQuantity"|attr:"oninput=count()" }}
            {{ form.non_field_errors }}
            {% if field.errors %}
            <ul class="form-errors">
                {% for error in field.errors %}
                <li><i class="material-icons">error</i> <strong>{{ error|escape }}</strong>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </td>
    <td id="value_{{ forloop.counter0 }}">{{ form.instance.unit_price | value_format }}</td>
    <td id="countResult_{{ forloop.counter0 }}">{{ form.instance.value_total | value_format }}</td>
    <td><a href="#" onclick="deleteProduct({{ forloop.counter0 }})"><button type="button" data-toggle="tooltip"
                data-placement="left" title="Відкрити в новому вікні"
                class="btn btn-danger material-icons">delete</button></a></td>
</tr>

<script>




function count(){
    var productQuantity = document.getElementById('id_invoiceline_set-' + '{{ forloop.counter0 }}' + '-quantity').value;
    var pricePerUnit = document.getElementById('value_' + '{{ forloop.counter0 }}').innerHTML;

    var priceNum = Number.parseFloat(pricePerUnit);
    var productQuantityNum = Number.parseFloat(productQuantity);

    var sumPrice = productQuantityNum * priceNum;
    var sumPrice = sumPrice.toFixed(2);
    var sumPrice = sumPrice + " грн."

    document.getElementById('countResult_' + '{{ forloop.counter0 }}').innerHTML = sumPrice;
};




{% comment %} 
document.addEventListener ("input", calcPrice())


function calcPrice() {
        
        var productQuantity = document.getElementById('id_invoiceline_set-' + '{{ forloop.counter0 }}' + '-quantity').value;
        var pricePerUnit = document.getElementById('value_' + '{{ forloop.counter0 }}').innerHTML;

        var priceNum = Number.parseFloat(pricePerUnit);
        var productQuantityNum = Number.parseFloat(productQuantity);

        var sumPrice = productQuantityNum * priceNum;
        var sumPrice = sumPrice.toFixed(2);
        var sumPrice = sumPrice + " грн."

        document.getElementById('countResult').innerHTML = sumPrice;

    }; {% endcomment %}


</script>
{% endfor %}